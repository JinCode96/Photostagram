<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org"
       xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
       layout:decorate="layout/memberLayout">

<th:block layout:fragment="main">
<script>
    $(function(){

        // 데이터 검증에 사용하는 정규표현식
        let regUserName = /^[a-z]+[a-z0-9]{5,19}$/g;
        let regName  = /^[가-힣]+$/
        let regEmail = /^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/i;
        let regPassword  = /^(?=.*[a-zA-z])(?=.*[0-9])(?=.*[$`~!@$!%*#^?&\\(\\)\-_=+]).{5,16}$/;

        // validation check
        let isUserNameOk = false;
        let isNameOk = false;
        let isEmailOk = false;
        let isPasswordOk = false;

        // 아이디 유효성 검증 & 중복체크
        $('#userName').focusout(function() {
            let userName = $('input[name=username]').val();

            if(isUserNameOk){
			    return;
            }

            if(!userName.match(regUserName)){
                isUidOk = false;
                console.log('아이디가 유효하지않음');
                $('.result-delete').addClass('on');
			    return;
		    }

            let jsonData = {"userName" : userName};

            $.ajax({
                url: '/Photostagram/member/chkUserName',
                type: 'POST',
                data: jsonData,
                dataType: 'json',
                success: function(data) {
                    if(data.result == 1) {
                        console.log('이미 사용중인 아이디');
                        $('.result-delete').addClass('on');
                        userNameChk = true;
                    } else {
                        console.log('사용 가능한 아이디');
                        $('.result-delete').removeClass('on');
                        userNameChk = false;
                    }
                }
            });

        });

        $('#register-btn').click(function(e){
            e.preventDefault();

            alert('register!!!');
            let username = $('input[name=username]').val();
            let name = $('input[name=name]').val();
            let email = $('input[name=email]').val();
            let password = $('input[name=password]').val();

            let userData = {
                "username": username,
                "name": name,
                "email": email,
                "password": password
            };

            sessionStorage.setItem("user", JSON.stringify(userData));
            location.href = '/Photostagram/member/birth';
        });

    });
</script>
<main class="member">
    <div class="container">
        <div class="main-container">
            <div class="main-content">
                <div class="form-container">
                    <div class="form-content box">
                        <div class="logo">
                            <img th:src="@{/img/logo_light.png}" alt="Instagram logo" class="logo-light">
                            <img th:src="@{/img/logo_dark.png}" alt="Instagram logo" class="logo-dark">
                        </div>
                        <div class="signin-form-reg" id="signin-form">
                            <div class="btn-group">
                            <p>친구들의 사진과 동영상을 보려면 가입하세요.</p>
                            <button class="btn-fb">
                                <img th:src="@{/img/facebook-icon.png}" alt="">
                                <span>Facebook으로 로그인</span>
                            </button>
                            </div>
                            <div class="divine">
                            <div></div>
                            <div>또는</div>
                            <div></div>
                            </div>
                            <form action="#" method="post">
                                <div class="form-group">
                                    <div class="animate-input">
                                        <span class="in-out">
                                            아이디 입력
                                        </span>
                                        <input type="text" name="username" class="able" id="userName">
                                    </div>
                                    <div class="chkUid">

                                    </div>
                                    <!--<span class="chkUid">
                                            <img class="result-img result-check on" th:src="@{/img/check-button.png}">
                                            <img class="result-img result-delete" th:src="@{/img/delete-button.png}">
                                        </span>-->
                                </div>
                                <div class="form-group">
                                    <div class="animate-input">
                                        <span class="in-out">
                                            성명
                                        </span>
                                        <input type="text" name="name">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="animate-input">
                                        <span class="in-out">
                                            이메일 입력
                                        </span>
                                        <input type="text" name="email" class="able">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="animate-input">
                                        <span class="in-out">
                                            비밀번호
                                        </span>
                                        <input type="password" name="password" class="able">
                                        <button type="button" class="passView">비밀번호 표시</button>
                                    </div>
                                </div>
                                <div class="btn-group">
                                    <button type="submit" class="btn-login" id="register-btn" disabled>
                                        다음
                                    </button>
                                </div>
                                <div class="checking">
                                    <div>이미 가입되어있는 아이디입니다.</div>
                                </div>
                            </form>                          
                        </div>
                    </div>
                    <div class="box goto">
                        <p>
                            계정이 있으신가요?
                            <a th:href="@{/member/login}">로그인</a>
                        </p>
                    </div>
                    <div class="app-download">
                        <p>앱을 다운로드 하세요.</p>
                        <div class="store-link">
                            <a href="#">
                                <img th:src="@{/img/appDownload.png}" alt="app store">
                            </a>
                            <a href="#">
                                <img th:src="@{/img/googlePlay.png}" alt="google play">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
</th:block>
</html>