<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.photostagram.dao.MainDAO">
    <!--게시글 업로드-->
    <insert id="insertPost" useGeneratedKeys="true" keyColumn="no" keyProperty="no" parameterType="kr.co.photostagram.vo.PostVO">
        insert into `post` set `content`=#{content}, `user_no`=#{user_no}, `rdate`=NOW();
    </insert>
    <!--이미지 업로드-->
    <insert id="insertImage">
        insert into `image` set `thumb`=#{thumb}, `post_no`=#{post_no};
    </insert>
    <!--해시태그 존재여부 확인-->
    <select id="findTagByContent" resultType="int">
        select count(`no`) from `hashtag` where `hashtag`=#{hashtag};
    </select>
    <!--해시태그 추가-->
    <insert id="saveTag" useGeneratedKeys="true" keyColumn="no" keyProperty="no" parameterType="kr.co.photostagram.vo.HashTagVO">
        insert into `hashtag` set `hashtag`=#{hashtag};
    </insert>
    <!--해시태그 번호 조회-->
    <select id="selectHashTagNo" resultType="int">
        select `no` from `hashtag` where `hashtag`=#{hashtag};
    </select>
    <!--태그-포스트 매핑 테이블 추가-->
    <insert id="saveTagAndPost">
        insert into `post_hashtag` set `hashtag_no`=#{hashtag_no}, `post_no`=#{post_no};
    </insert>
    <!--검색(해시태그)-->
    <select id="selectHashTag" resultType="kr.co.photostagram.vo.HashTagVO">
        SELECT * FROM `hashtag` WHERE `hashtag` LIKE CONCAT(#{searchItem},'%');
    </select>
    <!--검색(유저)-->
    <select id="selectUser" resultType="kr.co.photostagram.vo.MemberVO">
        SELECT * FROM `user` WHERE `username` LIKE CONCAT(#{searchItem},'%');
    </select>
    <!--검색(검색기록 삽입)-->
    <insert id="insertSearchItem">
        insert into `searchList` set
        `user_no`=#{user_no},
        `searchItem`=#{searchItem},
        `rdate`=NOW(),
        `cate`=#{cate},
        `result`=#{result},
        `img`=#{img},
        `text`=#{text};
    </insert>
    <!--검색기록 요청-->
    <select id="selectSearchItemRecent" resultType="kr.co.photostagram.vo.SearchListVO">
        select * from `searchList` where `user_no`=#{user_no} order by `rdate` desc;
    </select>
</mapper>