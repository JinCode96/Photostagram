<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org"
       xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
       layout:decorate="layout/memberLayout">

<th:block layout:fragment="main">
    <div class="container">
        <div class="main-container">
            <div class="main-content">
                <div class="slide-container" style="background-image: url(../img/phone-frame.png);">
                    <div class="slide-content" id="slide-content">
                        <img th:src="@{/img/slide (1).jpg}" alt="slide image" class="active">
                        <img th:src="@{/img/slide (2).jpg}" alt="slide image" class="slide">
                        <img th:src="@{/img/slide (3).jpg}" alt="slide image" class="slide">
                        <img th:src="@{/img/slide (4).jpg}" alt="slide image" class="slide">
                        <img th:src="@{/img/slide (5).jpg}" alt="slide image" class="slide">
                    </div>
                </div>
                <div class="form-container">
                    <div class="form-content box">
                        <div class="logo">
                            <img th:src="@{/img/logo_light.png}" alt="Instagram logo" class="logo-light">
                            <img th:src="@{/img/logo_dark.png}" alt="Instagram logo" class="logo-dark">
                        </div>
                        
                        <div class="signin-form" id="signin-form">
                            <form th:action="@{/member/login}" method="post">
                                <div class="form-group">
                                    <div class="animate-input">
                                        <span class="in-out">
                                            전화번호, 사용자 이름 또는 이메일
                                        </span>
                                        <input type="text" name="username" class="able">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="animate-input">
                                        <span class="in-out">
                                            비밀번호
                                        </span>
                                        <input type="password" name="password" id="pass" class="able">
                                        <button type="button" class="passView">비밀번호 표시</button>
                                    </div>
                                </div>
                                <div id="remember">
                                    <label for="rememberMe">로그인 상태 유지</label>
                                    <input type="checkbox" name="remember-me" id="rememberMe">
                                </div>
                                <th:block th:if="${success == '111'}">
                                    <div class="checking">
                                        <div>존재하지 않는 회원입니다.</div>
                                    </div>
                                </th:block>
                                <div class="btn-group">
                                    <button type="submit" class="btn-login" id="signin-btn" disabled>
                                        로그인
                                    </button>
                                </div>
                            </form>
                            <div class="divine">
                                <div></div>
                                <div>또는</div>
                                <div></div>
                            </div>
                            <div class="btn-group">
                                <button class="btn-fb" id="logBtn">
                                    <img th:src="@{/img/facebook-icon.png}" alt="페이스북 이미지">
                                    <span>Facebook으로 로그인</span>
                                </button>
                            </div>
                            <a th:href="@{/member/checkId}" class="forgot-pw">아이디를 잊으셨나요?</a>
                            <a th:href="@{/member/checkPass}" class="forgot-pw">비밀번호를 잊으셨나요?</a>
                        </div>
                    </div>
                    <div class="box goto">
                        <p>
                            계정이 없으신가요?
                            <a th:href="@{/member/register}">가입하기</a>
                        </p>
                    </div>
                    <div class="app-download">
                        <p>앱을 다운로드 하세요.</p>
                        <div class="store-link">
                            <a href="#">
                                <img th:src="@{/img/appDownload.png}" alt="app store">
                            </a>
                            <a href="#">
                                <img th:src="@{/img/googlePlay.png}" alt="google play">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
<script>
    // 로그인화면 슬라이드
    $(function(){
        let slide_content = document.querySelector('#slide-content')

        slide = () => {
            let slide_items = slide_content.querySelectorAll('img.slide')
            slide_items.forEach(e => e.classList.remove('active'))
            slide_index = slide_index + 1 === slide_items.length ? 0 : slide_index + 1
            slide_items[slide_index].classList.add('active')
        }
        setInterval(slide, 2000)
    });
</script>
<script>
//페이스북 (로그인) 기본 설정
window.fbAsyncInit = function () {
    //페이스북 로그인 기능 클라이언트 설정
    FB.init({
        appId: '229061809607478',
        autoLogAppEvents: true,
        xfbml: true,
        version: 'v10.0'
    });

    //페이스북 로그인 여부 확인
    FB.getLoginStatus(function (response) {
        statusChangeCallback(response);
    });
};

//로그인 상태에 따라 로그인 / 로그아웃 구분
const statusChangeCallback = (res)=>{
    if(res.status === 'connected')
        document.querySelector('#logBtn').value="로그아웃";
    else document.querySelector('#logBtn').value= "로그인";
}

//페이스북 (로그인)
const facebookLogin = ()=>{
    //로그인 정보 GET
    FB.login((res)=>{
        //사용자 정보 GET
        FB.api(
            `/${res.authResponse.userID}/`,
            'GET',
            {"fields":"id,name,email"},
            (res2) => {
            //res.authResponse.accessToken : 엑세스 토큰
            //res.authResponse.graphDomain : 공급자 (페이스북)
            //res.authResponse.userID : 유저 아이디 구분 (숫자)
            //res2.name : 유저 이름
            //res2.email : 유저 이메일 정보
            document.querySelector('#logBtn').value="로그아웃";
            console.log(res,res2);
        });
    });

}

//페이스북 (로그아웃)
const facebookLogout = ()=>{
    FB.logout((res)=>{
        document.querySelector('#logBtn').value= "로그인";
    });
}
</script>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
<script>
//로그인 버튼 클릭시
document.querySelector('#logBtn').addEventListener('click', e => {
    if(e.target.value === '로그인'){
        facebookLogin();
    } else {
        facebookLogout();
    }
});
</script>
<script th:src="@{/js/member.js}"></script>
</th:block>
</html>